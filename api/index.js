var X=Object.defineProperty;var z=(o,t,s)=>t in o?X(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var K=(o,t,s)=>z(o,typeof t!="symbol"?t+"":t,s);import M,{Router as Q}from"express";import j from"cors";import m from"@distube/ytdl-core";import{YouTube as L}from"youtube-sr";import u from"path";import v,{rm as C,unlink as R}from"fs";import U from"fluent-ffmpeg";import{path as G}from"@ffmpeg-installer/ffmpeg";import{v7 as $}from"uuid";import q from"cookie-parser";const H="tmp",J=[{name:"__Secure-1PAPISID",value:"lBfmHLLyZWCaf9ck/A7N0_glEesBQWM3eu",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:1},{name:"__Secure-1PSID",value:"g.a000rQgPzZnlbPApF8RvF6FthqUedukWmaKP0uS0OpApBtLZ4YBY12-Mbwq0wmgdJjvCWi9xtgACgYKAeUSARASFQHGX2MihK5bOSYlqZgCDJhvoELWtxoVAUF8yKqiht5lqZQcViXSurkpq6iJ0076",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:2},{name:"__Secure-1PSIDCC",value:"AKEyXzVdg76L_vxAbvklSPKgTYn85btT7VB0lIc7Zji3-eL28gafN-qzdEoSPUjQ1eXw0fw6",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1766092941,storeId:"firefox-private",id:3},{name:"__Secure-1PSIDTS",value:"sidts-CjEB7wV3sXdhL5ixPFhuJt2s7_Ub4J3poZXNgO6E-3Np_qm-sfrXMyvYL6keEEx40mX4EAA",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1766092936,storeId:"firefox-private",id:4},{name:"__Secure-3PAPISID",value:"lBfmHLLyZWCaf9ck/A7N0_glEesBQWM3eu",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:5},{name:"__Secure-3PSID",value:"g.a000rQgPzZnlbPApF8RvF6FthqUedukWmaKP0uS0OpApBtLZ4YBYuDbF14j3UvbK179L0ZDgdQACgYKATQSARASFQHGX2MiDhOVfcNe6HxZlz26O4MX_xoVAUF8yKone5QohbsaUyBgtg6PXa9j0076",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:6},{name:"__Secure-3PSIDCC",value:"AKEyXzUEvfOA_ggTuDBP-kXsxqq71HpKmZdCjseRb5bAVtQceS2e3xyvD-SBaP4-wignydZV",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1766092941,storeId:"firefox-private",id:7},{name:"__Secure-3PSIDTS",value:"sidts-CjEB7wV3sXdhL5ixPFhuJt2s7_Ub4J3poZXNgO6E-3Np_qm-sfrXMyvYL6keEEx40mX4EAA",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1766092936,storeId:"firefox-private",id:8},{name:"__Secure-ROLLOUT_TOKEN",value:"CJD-mdPZ3a-DGBDq-aGQoLKKAxjq-aGQoLKKAw%3D%3D",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1750108936,storeId:"firefox-private",id:9},{name:"APISID",value:"aT8VxYT0hHfxlM-y/A83wWrHRDvYDimBS_",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:10},{name:"GPS",value:"1",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1734558674,storeId:"firefox-private",id:11},{name:"HSID",value:"Aw2GhFINoaOvemZGl",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:12},{name:"LOGIN_INFO",value:"AFmmF2swRQIgRBtwp8AclPZYvz-96AINR-zgBPaGmZ0M0bwuJgHrxXECIQCLpDY48y1NEhx16uz0yrAsMcFnlCrzVT0KwWvOT1bSpA:QUQ3MjNmejRsTGYtc3lKTGxobFhxRmJSWlR0Q0htclVLS3hUYW5PWjlLSEQwM2lKcVA5VmNxYWEzRlBldUtqdnFvLUMyTV9Gc20wSXpncXpMWHdXN0dWa21DVmtmZElGRm85b3ZhQ3MxWXpscURLdnhvVFlRUzBwMEJfM3d4VEVUSFpOSkg3NF9FdWF1STB3aDFPdkNoU1RPYnVPZ05nSFpn",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:13},{name:"PREF",value:"f6=40000000&tz=Africa.Cairo",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116939,storeId:"firefox-private",id:14},{name:"SAPISID",value:"lBfmHLLyZWCaf9ck/A7N0_glEesBQWM3eu",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:15},{name:"SID",value:"g.a000rQgPzZnlbPApF8RvF6FthqUedukWmaKP0uS0OpApBtLZ4YBYKwigaP390I-fb14oZoD-jwACgYKATESARASFQHGX2MiSWVbrY4WrtS13a2ZxPMk9RoVAUF8yKpud-_8JyaknOzAd0y-BjBF0076",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:16},{name:"SIDCC",value:"AKEyXzXeHm-lVPskTxjUrsDiZOmHiqeErXgPVPUxUf31zv8oYFYLgV_ZAsQn8nItK6ChpxR7bg",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1766092941,storeId:"firefox-private",id:17},{name:"SSID",value:"AtRPgijnX2Fg-B_qu",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1769116936,storeId:"firefox-private",id:18},{name:"ST-3opvp5",value:"session_logininfo=AFmmF2swRQIgRBtwp8AclPZYvz-96AINR-zgBPaGmZ0M0bwuJgHrxXECIQCLpDY48y1NEhx16uz0yrAsMcFnlCrzVT0KwWvOT1bSpA%3AQUQ3MjNmejRsTGYtc3lKTGxobFhxRmJSWlR0Q0htclVLS3hUYW5PWjlLSEQwM2lKcVA5VmNxYWEzRlBldUtqdnFvLUMyTV9Gc20wSXpncXpMWHdXN0dWa21DVmtmZElGRm85b3ZhQ3MxWXpscURLdnhvVFlRUzBwMEJfM3d4VEVUSFpOSkg3NF9FdWF1STB3aDFPdkNoU1RPYnVPZ05nSFpn",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1734556944,storeId:"firefox-private",id:19},{name:"ST-l3hjtt",value:"session_logininfo=AFmmF2swRQIgRBtwp8AclPZYvz-96AINR-zgBPaGmZ0M0bwuJgHrxXECIQCLpDY48y1NEhx16uz0yrAsMcFnlCrzVT0KwWvOT1bSpA%3AQUQ3MjNmejRsTGYtc3lKTGxobFhxRmJSWlR0Q0htclVLS3hUYW5PWjlLSEQwM2lKcVA5VmNxYWEzRlBldUtqdnFvLUMyTV9Gc20wSXpncXpMWHdXN0dWa21DVmtmZElGRm85b3ZhQ3MxWXpscURLdnhvVFlRUzBwMEJfM3d4VEVUSFpOSkg3NF9FdWF1STB3aDFPdkNoU1RPYnVPZ05nSFpn",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1734556943,storeId:"firefox-private",id:20},{name:"ST-tladcw",value:"session_logininfo=AFmmF2swRQIgRBtwp8AclPZYvz-96AINR-zgBPaGmZ0M0bwuJgHrxXECIQCLpDY48y1NEhx16uz0yrAsMcFnlCrzVT0KwWvOT1bSpA%3AQUQ3MjNmejRsTGYtc3lKTGxobFhxRmJSWlR0Q0htclVLS3hUYW5PWjlLSEQwM2lKcVA5VmNxYWEzRlBldUtqdnFvLUMyTV9Gc20wSXpncXpMWHdXN0dWa21DVmtmZElGRm85b3ZhQ3MxWXpscURLdnhvVFlRUzBwMEJfM3d4VEVUSFpOSkg3NF9FdWF1STB3aDFPdkNoU1RPYnVPZ05nSFpn",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1734556943,storeId:"firefox-private",id:21},{name:"ST-xuwub9",value:"session_logininfo=AFmmF2swRQIgRBtwp8AclPZYvz-96AINR-zgBPaGmZ0M0bwuJgHrxXECIQCLpDY48y1NEhx16uz0yrAsMcFnlCrzVT0KwWvOT1bSpA%3AQUQ3MjNmejRsTGYtc3lKTGxobFhxRmJSWlR0Q0htclVLS3hUYW5PWjlLSEQwM2lKcVA5VmNxYWEzRlBldUtqdnFvLUMyTV9Gc20wSXpncXpMWHdXN0dWa21DVmtmZElGRm85b3ZhQ3MxWXpscURLdnhvVFlRUzBwMEJfM3d4VEVUSFpOSkg3NF9FdWF1STB3aDFPdkNoU1RPYnVPZ05nSFpn",domain:".youtube.com",hostOnly:!1,path:"/",secure:!1,httpOnly:!1,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1734556945,storeId:"firefox-private",id:22},{name:"VISITOR_INFO1_LIVE",value:"9JHS1Fj_oq4",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1750108936,storeId:"firefox-private",id:23},{name:"VISITOR_PRIVACY_METADATA",value:"CgJFRxIEGgAgGg%3D%3D",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!1,firstPartyDomain:"",partitionKey:null,expirationDate:1750108936,storeId:"firefox-private",id:24},{name:"YSC",value:"Dz_oBB-7qZk",domain:".youtube.com",hostOnly:!1,path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",session:!0,firstPartyDomain:"",partitionKey:null,storeId:"firefox-private",id:25}],x=m.createProxyAgent({uri:"http://181.215.253.112:5001",bodyTimeout:2e4},J),tt={origin:[/https:\/\/vidl-client.vercel.app/,/http:\/\/localhost:\d{4}/],credentials:!0,methods:["GET","POST"],optionsSuccessStatus:200};class D{constructor(t){K(this,"$sessionInfo",{sessionID:"",clientInfo:{state:"fetch",msg:"fetching info",progress:0},progressState:{duration:"",downloadProgressState:{total:0,finish:0},convertProgressState:{size:0,timeMark:""}}});typeof t=="string"?this.$sessionInfo.sessionID=t:this.$sessionInfo=t}set data(t){this.$sessionInfo=t}get data(){return this.$sessionInfo}set _clientInfo(t){this.$sessionInfo.clientInfo=t}get _clientInfo(){return this.$sessionInfo.clientInfo}set __duration(t){this.$sessionInfo.progressState.duration=t}get __duration(){return this.$sessionInfo.progressState.duration}set __downloadProgressState(t){this.$sessionInfo.progressState.downloadProgressState=t}get __downloadProgressState(){return this.$sessionInfo.progressState.downloadProgressState}set ___total(t){this.$sessionInfo.progressState.downloadProgressState.total=t}get ___total(){return this.$sessionInfo.progressState.downloadProgressState.total}set ___finish(t){this.$sessionInfo.progressState.downloadProgressState.finish=t}get ___finish(){return this.$sessionInfo.progressState.downloadProgressState.finish}set __convertProgressState(t){this.$sessionInfo.progressState.convertProgressState=t}get __convertProgressState(){return this.$sessionInfo.progressState.convertProgressState}}const N=o=>{const t=new Set;return m.filterFormats(o,s=>{var d,h,y,c;const e=(d=s==null?void 0:s.qualityLabel)==null?void 0:d.startsWith("4320p"),n=((h=s==null?void 0:s.qualityLabel)==null?void 0:h.startsWith("2160p"))||((y=s==null?void 0:s.qualityLabel)==null?void 0:y.startsWith("1440p")),r=s.hasVideo&&!s.hasAudio&&!URL.parse(s.url).hostname.includes("manifest")&&(e||n||!e&&!n),a=(c=s.qualityLabel)==null?void 0:c.split("p")[0],l=t.has(a);return r&&!l?(t.add(a),!0):!1})},B=o=>{const t=new Set;return m.filterFormats(o,s=>{const e=s.hasAudio&&!s.hasVideo,n=s.audioBitrate,r=t.has(n);return e&&!r?(t.add(n),!0):!1}).sort((s,e)=>e.audioBitrate-s.audioBitrate)},et=(o,t)=>{const s=new Map([[4320,{up:null,down:[2160,1440,1080,720,480,360,240,144]}],[2160,{up:[4320],down:[1440,1080,720,480,360,240,144]}],[1440,{up:[2160,4320],down:[1080,720,480,360,240,144]}],[1080,{up:[1440,2160,4320],down:[720,480,360,240,144]}],[720,{up:[1080,1440,2160,4320],down:[480,360,240,144]}],[480,{up:[720,1080,1440,2160,4320],down:[360,240,144]}],[360,{up:[480,720,1080,1440,2160,4320],down:[240,144]}],[240,{up:[360,480,720,1080,1440,2160,4320],down:[144]}],[144,{up:[240,360,480,720,1080,1440,2160,4320],down:null}]]);let e=0;if(e=o.findIndex(a=>a.qualityLabel.startsWith(`${t}p`)),e!==-1)return o[e];const n=s.get(t).up;if(n!==null){for(const a of n)if(e=o.findIndex(l=>l.qualityLabel.startsWith(`${a}`)),e!==-1)return o[e]}const r=s.get(t).down;if(r!==null){for(const a of r)if(e=o.findIndex(l=>l.qualityLabel.startsWith(`${a}`)),e!==-1)return o[e]}return null},st=(o,t)=>{const s=new Map([[160,{up:null,down:[128,64,48]}],[128,{up:[160],down:[64,48]}],[64,{up:[128,160],down:[48]}],[48,{up:[64,128,160],down:null}]]);let e=0;if(e=o.findIndex(a=>a.audioBitrate===t),e!==-1)return o[e];const n=s.get(t).up;if(n!==null){for(const a of n)if(e=o.findIndex(l=>l.audioBitrate===a),e!==-1)return o[e]}const r=s.get(t).down;if(r!==null){for(const a of r)if(e=o.findIndex(l=>l.audioBitrate===a),e!==-1)return o[e]}return null},T=o=>{const[t,s,e]=o.split(":");return+t*60*60+ +s*60+ +e},ot=(o,t)=>Math.floor(T(o)/T(t)*100),nt=o=>{const e=o/1048576,n=o%1048576/1024;return e>>>0?e.toFixed(2)+" gb":n>>>0?n.toFixed(2)+" mb":o+" kb"},rt=o=>{const t=u.resolve(g,o);try{if(v.existsSync(t))throw new Error(`[${t}] folder already exists`);v.mkdirSync(t,{recursive:!0})}catch{return{sessionFolderPath:t,error:!0}}return{sessionFolderPath:t,error:!1}},A=(o,t)=>{const s=u.resolve(g,o,"info.json");try{v.writeFileSync(s,JSON.stringify(t),{flag:"w",encoding:"utf-8"})}catch{return!1}return!0},E=o=>{try{const t=u.resolve(g,o,"info.json");return{success:!0,sessionInfo:JSON.parse(v.readFileSync(t,{encoding:"utf-8"}))}}catch{return{success:!1}}},F=(o,t,s)=>{const e=E(t);if(e.success){const n=new D(e.sessionInfo);switch(o){case"download":{n.___finish=n.___finish+1;const{total:r,finish:a}=n.__downloadProgressState;n._clientInfo={state:"progress",msg:`preparing...(${a}/${r})`,progress:Math.floor(a/r*100)};break}case"convert":{const{size:r,timeMark:a}=s;n.__convertProgressState={size:r,timeMark:a},n._clientInfo={state:"progress",msg:`converting...(${nt(r)})`,progress:ot(a,n.__duration)};break}case"duration":{n.__duration=s.duration;break}}A(t,n.data)}},V=(o,t,s,e)=>new Promise(n=>{const r=v.createWriteStream(o);s.hasVideo;let a=!1;m.downloadFromInfo(t,{format:s,agent:x}).on("error",l=>{a=!0,r.end(),n({ok:!1})}).pipe(r).on("finish",()=>{a||(r.end(),F("download",e),n({ok:!0}))}).on("error",l=>{r.end(),n({ok:!1})}).on("close",()=>{})}),at=o=>{const t=new URL(o);return t.searchParams.delete("si"),t.href},i=!1,g=`/${H}`;U.setFfmpegPath(G);const it=async(o,t)=>{const{body:{searchUrl:s}}=o;try{if(m.validateURL(s)){const e=await m.getInfo(s,{agent:x}),n=e.formats,r=N(n),a=B(n);t.status(200).json({info:{videoFormats:r,audioFormats:a,videoDetails:e.videoDetails},type:"video"})}else if(L.validate(at(s),"PLAYLIST")){const e=await L.getPlaylist(s,{fetchAll:!0,limit:1/0});t.status(200).json({info:{id:e.id,videoCount:e.videoCount,views:e.views,channel:e.channel,lastUpdate:e.lastUpdate,link:e.link,mix:e.mix,thumbnail:e.thumbnail,title:e.title,type:e.type,url:e.url,videos:e.videos,fake:e.fake},type:"list"})}else t.status(200).json({errMsg:"Invalid youtube url",type:"none"})}catch(e){t.status(200).json({errMsg:e.message,type:"none"})}},lt=async(o,t)=>{const s=$(),e=new D(s),{error:n}=rt(s);if(n)t.sendStatus(206);else{if(!A(s,e.data)){t.sendStatus(206);return}t.status(200).json({sessionID:s,progressInfo:e._clientInfo})}},ut=async(o,t)=>{const{body:{sessionID:s}}=o,e=u.resolve(g,s,"info.json");v.readFile(e,{encoding:"utf-8"},(n,r)=>{if(n)t.status(200).json({state:"error",msg:"session closed 💀",progress:0});else{const a=JSON.parse(r);t.status(200).json(a.clientInfo)}})},Y=async(o,t,s)=>{const{body:{sessionID:e}}=o;t.on("finish",()=>{const n=u.resolve(g,e);C(n,{recursive:!0,force:!0},r=>{})}),s()},k=(o,t,s)=>{const{body:{searchUrl:e}}=o;try{if(!m.validateURL(e)){t.sendStatus(201);return}}catch{t.sendStatus(201);return}s()},Z=(o,t,s)=>{const{body:{sessionID:e}}=o;try{const n=u.resolve(g,e);if(!v.existsSync(n)){t.sendStatus(202);return}}catch{t.sendStatus(202);return}s()},dt=async(o,t)=>{const{body:{searchUrl:s,quality:e,sessionID:n}}=o;try{const r=await m.getInfo(s,{agent:x}),a=r.formats,l=et(N(a),e);if(l===null)throw new Error("Video format doesn't exist");const d=B(a)[0];if(d===void 0)throw new Error("Audio format doesn't exist");const h=E(n);if(!h.success){t.sendStatus(203);return}const y=new D(h.sessionInfo);if(y.___total=2,!A(n,y.data)){t.sendStatus(204);return}const c=u.resolve(g,n),w=u.resolve(c,`video.${l.container}`),I=u.resolve(c,`audio.${d.container}`),[p,_]=await Promise.allSettled([V(w,r,l,n),V(I,r,d,n)]);if(!p.value.ok||!_.value.ok){t.sendStatus(205);return}const b=u.resolve(c,"output.mp4");U(w).format("mp4").audioBitrate(d.audioBitrate).mergeAdd(I).saveToFile(b).on("start",()=>{}).on("codecData",S=>{const O={duration:S.duration};F("duration",n,O)}).on("progress",({targetSize:S,timemark:O})=>{F("convert",n,{size:S,timeMark:O})}).on("end",()=>{R(w,S=>{}),R(I,S=>{}),t.status(200).download(b,S=>{if(S){t.sendStatus(205);return}})}).on("error",S=>{t.sendStatus(205)})}catch{t.sendStatus(205)}},ct=async(o,t)=>{const{body:{searchUrl:s,quality:e,sessionID:n}}=o;try{const r=await m.getInfo(s,{agent:x}),a=r.formats,l=st(B(a),e);if(l===null)throw new Error("Audio format doesn't exist");const d=E(n);if(!d.success){t.sendStatus(203);return}const h=new D(d.sessionInfo);if(h.___total=1,!A(n,h.data)){t.sendStatus(204);return}const y=u.resolve(g,n),c=u.resolve(y,`audio.${l.container}`);if(!(await V(c,r,l,n)).ok){t.sendStatus(205);return}const I=u.resolve(y,"output.mp3");U(c).format("mp3").audioBitrate(l.audioBitrate).saveToFile(I).on("start",()=>{}).on("codecData",p=>{const _={duration:p.duration};F("duration",n,_)}).on("progress",({targetSize:p,timemark:_})=>{F("convert",n,{size:p,timeMark:_})}).on("end",()=>{R(c,p=>{}),t.status(200).download(I,p=>{if(p){t.sendStatus(205);return}})}).on("error",p=>{t.sendStatus(205)})}catch{t.sendStatus(205)}},ft=async(o,t)=>{const{body:{listUrl:s}}=o;t.status(200).json({listUrl:s})},P=Q();P.post("/smart-search",it);P.post("/progress-info",ut);P.post("/video-download",k,Z,Y,dt);P.post("/audio-download",k,Z,Y,ct);P.post("/list-download",ft);var pt=P;const W=Q();W.get("/ods",lt);W.use("/youtube",pt);var mt=W;const f=M();f.use(M.json({limit:"10mb"}));f.use(M.urlencoded({extended:!1,limit:"10mb"}));f.use(q());f.use(j(tt));f.use("/api",mt);f.get("/",async(o,t)=>{t.status(200).json({msg:"Welcome to VIDL API"})});f.get("*",async(o,t)=>{t.sendStatus(404)});{const o=process.env.PORT??3e3;f.listen(o,()=>{console.log(`Server Running On Port ${o}`)})}const At=f;var bt=f;export{bt as default,At as viteNodeApp};
